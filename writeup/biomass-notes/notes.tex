\documentclass[authoryear, review, 11pt]{elsarticle}

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{mathabx}
\usepackage{bm}

%\geometry{landscape}                % Activate for for rotated page geometry
\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{verbatim}


\newcommand{\ig}{\includegraphics}

\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}


% title info
\title{Spatial smoothing of zero-inflated abundance data}
%\subtitle{A researcher's perspective}
\author{Wesley Brooks}


\usepackage{filecontents}

\begin{filecontents}{notes.bib}
@book{Wood-2006,
title = {Generalized additive models: an introduction with R},
author = {Wood, Simon},
location = {Boca Raton},
publisher = {Chapman and Hall},
year = {2006},
}
\end{filecontents}


\begin{document}
\maketitle

\section{Introduction}
The biomass of several taxa of trees was estimated in each grid cell of the upper midwestern United States (Minnesota, Wisconsin, and part of Michigan) from the Public Land Survey. This work describes the model that was used to spatially smooth the biomass estimates in order to produce draws from an underlying distribution of the per-taxon biomass in each grid cell.

In order to more quickly assess the model, it was fit to just the data from Wisconsin before being applied to the entire upper midwest. Also, because the model failed to converge for about half of the individual taxa, the decision was made to reduce the taxa to two categories: hardwoods and softwoods. The following taxa were summed in each grid cell to generate the observations of the softwood biomass:
\begin{itemize}
 \item Tamarack
 \item Pine
 \item Fir
 \item Cedar
 \item Spruce
 \item Hemlock
\end{itemize}

The following taxa were summed in each grid cell to generate the observations of the hardwood biomass:
\begin{itemize}
 \item Ashes
 \item Birches
 \item Elms
 \item Maple
 \item Poplar
 \item Basswood
 \item Oaks
 \item Willow
 \item Alder
 \item Ironwoods
 \item Walnuts
 \item Hickory
 \item Beech
 \item Celtis
 \item Cherries
 \item Juniper
 \item Rose trees
 \item Sycamore
 \item Cornus
 \item Buckeye
 \item Undifferentiated hardwood
\end{itemize}


\section{Models}

\subsection{Tweedie distribution}

The model for biomass is a Tweedie model, which can be thought of as a Poisson-Gamma mixture. Let the response be $Y$ and E$Y$ = $\mu$. Now $Y$ is a sum of $N$ iid Gamma-distributed random variables $Z_1, \dots, Z_N$. The number, $N$, of iid Gamma random variables, has a Poisson distribution, which means it could be exactly zero. That is,
\begin{align*}
    Y &= \sum\limits_{i=1}^N Z_i \\
    N &\sim \text{Poisson}(\lambda) \\
    Z_i &\sim \text{Gamma}(\alpha, \tau)
\end{align*}

Two variables control the Poisson mean $\lambda$; a power parameter $\theta \in (1,2)$ and a dispersion parameter $\phi > 0$.
\begin{align*}
    \lambda &= \phi^{-1} \frac{\mu^{2-\theta}}{2-\theta}
\end{align*}

The parameters of the Gamma distribution are
\begin{align*}
    \alpha &= \frac{2-\theta}{\theta-1} \\
    \tau &= \phi (\theta - 1) \mu^{\theta - 1}
\end{align*}

And, as usual for a generalized linear model (GLM), we define a link function, $g(\dot)$, that converts the fitted values $\hat{y}$ to the linear predictor $\eta$. In this case, the log link is used.
\begin{align*}
    \eta &= g\left(\mu\right)
\end{align*}

\subsection{Generalized additive model}
The model is fit to the data using a generalized additive model (GAM) that has the spatial coordinates $\bm{s} = (\text{lat}, \text{long})$ as its only covariates. The GAM for just the Wisconsin data used a spline smooth with 500 knots. 

\subsection{Tuning the Tweedie power parameter}
The Tweedie distribution is in the exponential family only when the power parameter $\theta$ is prespecified. The usual parameter estimation machinery for a GAM or GLM requires that the observations be from a distribution in the exponential family, so using the Tweedie distribution requires the power parameter to be estimated separately from the parameters of the GAM. In the model for biomass, R's \verb!optimize! function was used to find an estimate $\hat{\theta}$ that maximized the likelihood of the observed data.

\subsection{Drawing from the model output}
Having estimated the Tweedie power parameter and the parameters of the GAM, it is possible to make draws from the resulting model for biomass. However, the GAM's smoothing parameters and the Tweedie power parameter are estimated as points, without acknowledging uncertainty in those parameters. The parametric bootstrap was used to make draws from biomass that allow for uncertainty in the smoothing and power parameters.

This application of the parametric bootstrap was modeled after section 5.4.2 of \cite{Wood-2006}, but that example is for a poisson distribution and does not require the estimation of a Tweedie power parameter. For the models of biomass, the power parameter and smoothing parameter were estimated jointly for each repetition of the bootstrap.


\section{Results}
Histograms of the total biomass as estimated by the models for hardwoods and softwoods are presented as Figure \ref{hardwood-hist} and \ref{softwood-hist}, respectively. Each histogram is based on 2000 draws of the biomass at each of the 2436 grid cells in Wisconsin. The values for each draw of the (log) biomass are in the files logbiomass-WI-hardwood.csv and logbiomass-WI-softwood.csv, respectively. The files are available on request (each is approximately 80MB).

Producing the model draws for each category took approximately seven hours on the 'bigmem' servers at the University of Wisconsin-Madison's department of statistics. Scaling up to the upper midwest has been challenging - the first (iterative) step of fitting that model with 2000 knots took three hours before I killed the process (generating the draws requires a few hundred such steps). It is currently running with 1000 knots, which is probably insufficient to cover the area with acceptable detail.

\begin{figure}
\begin{centering}
\ig[width=0.7\textwidth]{../../figures/biomass/hardwood-histogram}
\caption{Distribution of the total hardwood biomass for Wisconsin. The vertical line represents the sum of the Wisconsin hardwood biomass observations.\label{hardwood-hist}}
\end{centering}
\end{figure}

\begin{figure}
\begin{centering}
\ig[width=0.7\textwidth]{../../figures/biomass/softwood-histogram}
\caption{Distribution of the total softwood biomass for Wisconsin. The vertical line represents the sum of the Wisconsin softwood biomass observations.\label{softwood-hist}}
\end{centering}
\end{figure}


\section{Bibliography}
\bibliographystyle{abbrv}
\bibliography{notes}

\end{document}
